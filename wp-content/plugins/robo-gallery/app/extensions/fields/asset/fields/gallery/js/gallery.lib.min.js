/*

*      Robo Gallery     
*      Version: 3.0.3 - 31466
*      By Robosoft
*
*      Contact: https://robosoft.co/robogallery/ 
*      Created: 2015
*      Licensed under the GPLv2 license - http://opensource.org/licenses/gpl-2.0.php


*/
!function(t,e){if(void 0!==wp.media.view.emWpGallery)return console.log("EM Gallery already defined"),!1;var i=wp.media.view.MediaFrame.Select,a=wp.media.controller.Library,r=wp.media.view.l10n;wp.media.view.emWpGallery=i.extend({initialize:function(){this.counts={audio:{count:wp.media.view.settings.attachmentCounts.audio,state:"playlist"},video:{count:wp.media.view.settings.attachmentCounts.video,state:"video-playlist"}},e.defaults(this.options,{multiple:!0,editing:!0,state:"insert",metadata:{}}),i.prototype.initialize.apply(this,arguments),this.createIframeStates()},createStates:function(){var t=this.options;this.states.add([new a({id:"insert",title:r.insertMediaTitle,priority:20,toolbar:"main-insert",filterable:"all",library:wp.media.query(t.library),multiple:!!t.multiple&&"reset",editable:!1}),new a({id:"gallery",title:r.createGalleryTitle,priority:40,toolbar:"main-gallery",filterable:"uploaded",multiple:"add",editable:!0,library:wp.media.query(e.defaults({type:"image"},t.library))}),new wp.media.controller.EditImage({model:t.editImage}),new wp.media.controller.GalleryEdit({library:t.selection,editing:t.editing,menu:"gallery",multiple:!0,displaySettings:!1,displayUserSettings:!1}),new wp.media.controller.GalleryAdd({multiple:"add",editable:!0})])},bindHandlers:function(){var t;i.prototype.bindHandlers.apply(this,arguments),this.on("activate",this.activate,this),void 0!==e.find(this.counts,function(t){return 0===t.count})&&this.listenTo(wp.media.model.Attachments.all,"change:type",this.mediaTypeCounts),this.on("menu:create:gallery",this.createMenu,this),this.on("toolbar:create:main-insert",this.createToolbar,this),this.on("toolbar:create:gallery-add",this.createToolbar,this),this.on("toolbar:create:main-gallery",this.createToolbar,this),this.on("toolbar:create:main-embed",this.mainEmbedToolbar,this),t={menu:{default:"mainMenu",gallery:"galleryMenu"},content:{embed:"embedContent","edit-image":"editImageContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar","main-gallery":"mainGalleryToolbar","gallery-edit":"galleryEditToolbar","gallery-add":"galleryAddToolbar"}},e.each(t,function(t,i){e.each(t,function(t,e){this.on(i+":render:"+e,this[t],this)},this)},this)},activate:function(){e.each(this.counts,function(t){t.count<1&&this.menuItemVisibility(t.state,"hide")},this)},mediaTypeCounts:function(t,e){void 0!==this.counts[e]&&this.counts[e].count<1&&(this.counts[e].count++,this.menuItemVisibility(this.counts[e].state,"show"))},mainMenu:function(t){},menuItemVisibility:function(t,e){var i=this.menu.get();"hide"===e?i.hide(t):"show"===e&&i.show(t)},galleryMenu:function(t){var e=this.lastState(),i=e&&e.id,a=this;t.set({cancel:{text:r.cancelGalleryTitle,priority:20,click:function(){i?a.setState(i):a.close(),this.controller.modal.focusManager.focus()}},separateCancel:new wp.media.View({className:"separator",priority:40})})},embedContent:function(){var t=new wp.media.view.Embed({controller:this,model:this.state()}).render();this.content.set(t)},editSelectionContent:function(){var t,e=this.state(),i=e.get("selection");(t=new wp.media.view.AttachmentsBrowser({controller:this,collection:i,selection:i,model:e,sortable:!0,search:!1,date:!1,dragInfo:!0,AttachmentView:wp.media.view.Attachments.EditSelection}).render()).toolbar.set("backToLibrary",{text:r.returnToLibrary,priority:-100,click:function(){this.controller.content.mode("browse"),this.controller.modal.focusManager.focus()}}),this.content.set(t),this.trigger("edit:selection",this)},editImageContent:function(){var t=this.state().get("image"),e=new wp.media.view.EditImage({model:t,controller:this}).render();this.content.set(e),e.loadEditor()},selectionStatusToolbar:function(t){var e=this.state().get("editable");t.set("selection",new wp.media.view.Selection({controller:this,collection:this.state().get("selection"),priority:-40,editable:e&&function(){this.controller.content.mode("edit-selection")}}).render())},mainInsertToolbar:function(t){var e=this;this.selectionStatusToolbar(t),t.set("insert",{style:"primary",priority:80,text:r.insertIntoPost,requires:{selection:!0},click:function(){var t=e.state(),i=t.get("selection");e.close(),t.trigger("insert",i).reset()}})},mainGalleryToolbar:function(t){var e=this;this.selectionStatusToolbar(t),t.set("gallery",{style:"primary",text:r.createNewGallery,priority:60,requires:{selection:!0},click:function(){var t=e.state().get("selection"),i=e.state("gallery-edit"),a=t.where({type:"image"});i.set("library",new wp.media.model.Selection(a,{props:t.props.toJSON(),multiple:!0})),this.controller.setState("gallery-edit"),this.controller.modal.focusManager.focus()}})},galleryEditToolbar:function(){var t=this.state().get("editing");this.toolbar.set(new wp.media.view.Toolbar({controller:this,items:{insert:{style:"primary",text:t?r.updateGallery:r.insertGallery,priority:80,requires:{library:!0},click:function(){var t=this.controller,e=t.state();t.close(),e.trigger("update",e.get("library")),t.setState(t.options.state),t.reset()}}}}))},mainInsertToolbar:function(t){var e=this;this.selectionStatusToolbar(t),t.set("insert",{style:"primary",priority:80,text:r.insertIntoPost,requires:{selection:!0},click:function(){var t=e.state(),i=t.get("selection");e.close(),t.trigger("insert",i).reset()}})},galleryAddToolbar:function(t){this.selectionStatusToolbar(t),t.set("insert",{style:"primary",text:r.addToGallery,priority:80,requires:{selection:!0},click:function(){var t=this.controller,e=t.state();t.state("gallery-edit").get("library").add(e.get("selection").models),e.trigger("reset"),t.setState("gallery-edit"),this.controller.modal.focusManager.focus()}})}})}(jQuery,_);