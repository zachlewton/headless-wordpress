/* 
*      Robo Gallery     
*      Version: 3.0.3 - 31466
*      By Robosoft
*
*      Contact: https://robosoft.co/robogallery/ 
*      Created: 2015
*      Licensed under the GPLv2 license - http://opensource.org/licenses/gpl-2.0.php

 */
!function(e){function t(e){var t=jQuery(r),a={action:"robo_gallery_get_images_from_ids",idstring:e};jQuery.post(ajaxurl,a,function(e){t.html(e);var a=t.find("img").length;a<=10?t.addClass("items10"):a<=20?t.addClass("items20"):a<=30?t.addClass("items30"):t.addClass("items50")})}var a,l,n,i,o="gallery-library",r=document.getElementById("robo_gallery_images_preview"),s=document.getElementsByClassName("roboGalleryFieldImagesButton");if(0!=s.length){s=s[0],n=document.getElementById(s.getAttribute("data-id")),t(l=n.value),i=""==l?[]:l.split(","),r.addEventListener("click",function(e){e.preventDefault(),e.target.matches("img")&&s.click()});var d=function(e){a?a.open():(i.length>0&&(o="gallery-edit"),(a=new wp.media.view.emWpGallery({multiple:!0,state:o,library:{order:"ASC",orderby:"title",type:"image",search:null,uploadedTo:null,multiple:!0}})).on("ready",function(){if(0!=i.length){var e=a.state().get("library");wp.media.query({post__in:i}).more().then();i.forEach(function(t){attachment=wp.media.attachment(t),void 0!=attachment.attributes&&(attachment.attributes.sizes={medium:{url:roboGalleryFieldGallery.iconUrl}}),attachment.fetch(),e.add(attachment?[attachment]:[])})}}),a.on("open",function(){0!=i.length&&"gallery-edit"!=o&&(a.setState("gallery-edit"),a.options.state="gallery-edit",o="gallery-edit")}),a.on("insert",function(){var e=a.state().get("selection");console.log(e)}),a.on("update",function(e){var o,r=a.state();if(o=e||r.get("selection")){var s=o.toJSON();if(0!=s.length){i=[];for(var d=0;d<s.length;d++)i.push(s[d].id);l=i.join(","),console.log("idsList",l),t(l),n.value=l,console.log("gallery array",i)}}else console.log("return selection")}),a.open())};s.addEventListener("click",d)}else console.log("button not found ")}(jQuery);